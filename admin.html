<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Trang Admin</title>
  <style>
    body { font-family: Arial; margin: 0; padding: 0; background: #f9f9f9; }
    header { background: #007bff; color: white; padding: 15px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    h2 { margin-top: 20px; }
    section { padding: 20px; }
    .btn { padding: 5px 10px; background: red; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <header><h1>Quản trị hệ thống</h1></header>
  <section>
    <h2>Danh sách người dùng</h2>
    <table id="userTable">
      <thead>
        <tr><th>ID</th><th>Username</th><th>Role</th><th>Hành động</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>Danh sách bệnh nhân</h2>
    <table id="patientTable">
      <thead>
        <tr><th>ID</th><th>Tên</th><th>Giới tính</th><th>Ngày sinh</th><th>Hành động</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    // Load danh sách người dùng
    async function loadUsers() {
      try {
        const res = await fetch("http://localhost:8080/users/getAll");
        const data = await res.json();
        const table = document.querySelector("#userTable tbody");
        table.innerHTML = data.map(user => `
          <tr>
            <td>${user.userId}</td>
            <td>${user.username}</td>
            <td>${user.role}</td>
            <td><button class="btn" onclick="deleteUser(${user.userId})">Xóa</button></td>
          </tr>
        `).join("");
      } catch (err) {
        console.error("Không thể tải danh sách người dùng:", err);
      }
    }

    // Load danh sách bệnh nhân
    async function loadPatients() {
      try {
        const res = await fetch("http://localhost:8080/patients/get/getall");
        const data = await res.json();
        const table = document.querySelector("#patientTable tbody");
        table.innerHTML = data.map(p => `
          <tr>
            <td>${p.patientId}</td>
            <td>${p.name || 'N/A'}</td>
            <td>${p.gender}</td>
            <td>${p.dateOfBirth}</td>
            <td><button class="btn" onclick="deletePatient(${p.patientId})">Xóa</button></td>
          </tr>
        `).join("");
      } catch (err) {
        console.error("Không thể tải danh sách bệnh nhân:", err);
      }
    }

    // Xóa người dùng
    async function deleteUser(id) {
      if (confirm("Bạn có chắc muốn xóa người dùng này không?")) {
        await fetch("http://localhost:8080/users/delete/" + id, {
          method: "DELETE"
        });
        loadUsers();
      }
    }

    // Xóa bệnh nhân
    async function deletePatient(id) {
      if (confirm("Bạn có chắc muốn xóa bệnh nhân này không?")) {
        await fetch("http://localhost:8080/patients/delete/" + id, {
          method: "DELETE"
        });
        loadPatients();
      }
    }

    // Gọi khi trang được tải
    loadUsers();
    loadPatients();
  </script>
</body>
</html>
